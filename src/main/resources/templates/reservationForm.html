<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{fragments/layout}">
<head>
  <meta charset="UTF-8">
  <title layout:fragment="title">ì˜ˆì•½ê¸€ ì‘ì„±</title>

  <!-- âœ… ê°œë³„ CSS -->
  <th:block layout:fragment="add-css">
    <link rel="stylesheet" th:href="@{/css/reservation_form.css}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  </th:block>
</head>

<body>
<main layout:fragment="content" class="reservation-form-container">
  <h1>ì˜ˆì•½ê¸€ ì‘ì„±</h1>

  <form th:action="@{/reservation/new}" method="post" enctype="multipart/form-data">
    <!-- ğŸ”¹ ì œëª© -->
    <div>
      <label for="title">ì œëª©</label>
      <input type="text" id="title" name="title" required>
    </div>

    <!-- ğŸ”¹ ì˜ˆì•½ íƒ€ì… -->
    <div>
      <label for="type">ì˜ˆì•½ íƒ€ì…</label>
      <select id="type" name="type" required>
        <option value="">ì„ íƒí•˜ì„¸ìš”</option>
        <option value="BOAT">ì„ ìƒë‚šì‹œ</option>
        <option value="ROCK">ê°¯ë°”ìœ„</option>
        <option value="FLOAT">ì¢ŒëŒ€</option>
        <option value="ISLAND">ì„¬</option>
        <option value="STAY">ìˆ™ë°•/ë¯¼ë°•/ìº í•‘</option>
      </select>
    </div>

    <!-- ğŸ”¹ ì§€ì—­ ì„ íƒ -->
    <div>
      <label for="regionId">ì§€ì—­</label>
      <select id="regionId" name="regionId" required>
        <option th:each="region : ${regions}"
                th:value="${region.id}"
                th:text="${region.name}">ì§€ì—­ëª…</option>
      </select>
    </div>

    <!-- ğŸ”¹ ì–´ì¢… ì„ íƒ -->
    <div>
      <label>ëŒ€ìƒ ì–´ì¢…</label><br/>
      <div th:each="fish : ${fishTypes}">
        <label>
          <input type="checkbox" name="fishTypeIds" th:value="${fish.id}" />
          <span th:text="${fish.name}">ì–´ì¢…ëª…</span>
        </label>
      </div>
    </div>

    <!-- ğŸ”¹ ê°€ê²© -->
    <div>
      <label for="price">ê°€ê²©</label>
      <input type="number" id="price" name="price" required>
    </div>

    <!-- ğŸ”¹ ì´ë¯¸ì§€ ì—…ë¡œë“œ -->
    <div>
      <label for="image">ëŒ€í‘œ ì´ë¯¸ì§€</label>
      <input type="file" id="image" name="imageFile">
    </div>

    <!-- ğŸ”¹ ìƒì„¸ ì„¤ëª… -->
    <div>
      <label for="content">ìƒì„¸ ì„¤ëª…</label>
      <textarea id="content" name="content" rows="5" required></textarea>
    </div>

    <!-- ğŸ”¹ ë‚ ì§œ + ì •ì› ì„ íƒ -->
    <div>
      <label>ì˜ˆì•½ ê°€ëŠ¥ ë‚ ì§œ + ì •ì›</label><br>
      <input type="text" id="datePicker" placeholder="ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”" readonly>
      <div id="dateContainer"></div>
    </div>

    <!-- ğŸ”¹ ì œì¶œ -->
    <div style="margin-top: 20px;">
      <button type="submit">ë“±ë¡í•˜ê¸°</button>
    </div>
  </form>
</main>

<!-- âœ… ê°œë³„ JS -->
<th:block layout:fragment="add-js">
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <script>
    flatpickr("#datePicker", {
      mode: "multiple",
      dateFormat: "Y-m-d",
      onChange: function(selectedDates, dateStr, instance) {
        const container = document.getElementById("dateContainer");
        container.innerHTML = "";

        selectedDates.forEach((date, idx) => {
          const formatted = date.toISOString().split("T")[0];

          const div = document.createElement("div");
          div.innerHTML = `
            <label>${formatted}</label>
            <input type="hidden" name="availableDates[${idx}].date" value="${formatted}">
            <input type="number" name="availableDates[${idx}].capacity" placeholder="ì •ì›" min="1" required>
          `;
          container.appendChild(div);
        });
      }
    });
  </script>
</th:block>
</body>
</html>
